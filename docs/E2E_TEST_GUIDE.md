# 文化財登録機能 E2Eテスト手順書

## 概要

このドキュメントは、文化財登録機能の手動E2Eテスト手順を記載しています。

---

## 前提条件

- フロントエンド: `npm run dev` で起動済み
- バックエンド: Django サーバー起動済み
- テストユーザーアカウントが作成済み

---

## テストケース

### 1. 認証関連

#### 1.1 未ログイン状態でのアクセス制限

| #   | 手順                                     | 期待結果                       |
| --- | ---------------------------------------- | ------------------------------ |
| 1   | `/cultural-properties/new` にアクセス    | サインインページにリダイレクト |
| 2   | `/mypage` にアクセス                     | サインインページにリダイレクト |
| 3   | `/cultural-properties/1/edit` にアクセス | サインインページにリダイレクト |

#### 1.2 ログイン後のリダイレクト

| #   | 手順                                                   | 期待結果                                  |
| --- | ------------------------------------------------------ | ----------------------------------------- |
| 1   | 未ログイン状態で `/cultural-properties/new` にアクセス | サインインページにリダイレクト            |
| 2   | サインインを完了                                       | `/cultural-properties/new` にリダイレクト |

---

### 2. 文化財登録

#### 2.1 新規登録（正常系）

| #   | 手順                                                 | 期待結果                                               |
| --- | ---------------------------------------------------- | ------------------------------------------------------ |
| 1   | ログイン状態で `/cultural-properties/new` にアクセス | 登録フォームが表示される                               |
| 2   | 名称: 「テスト神社」を入力                           | 入力が反映される                                       |
| 3   | 種別: 「国指定」を選択                               | 選択が反映される                                       |
| 4   | 住所: 「東京都千代田区」を入力                       | 入力が反映される                                       |
| 5   | 地図をクリックして位置を選択                         | マーカーが表示され、緯度経度が更新される               |
| 6   | 「確認画面へ」ボタンをクリック                       | 確認画面に遷移                                         |
| 7   | 入力内容を確認                                       | 入力した内容が正しく表示される                         |
| 8   | 「登録する」ボタンをクリック                         | 完了画面に遷移                                         |
| 9   | 完了画面を確認                                       | 「登録が完了しました」メッセージと文化財名が表示される |

#### 2.2 新規登録（必須項目未入力）

| #   | 手順                                         | 期待結果                             |
| --- | -------------------------------------------- | ------------------------------------ |
| 1   | 名称を空のまま「確認画面へ」をクリック       | 「名称は必須です」エラーが表示される |
| 2   | 種別を選択せず「確認画面へ」をクリック       | 「種別は必須です」エラーが表示される |
| 3   | 住所を空のまま「確認画面へ」をクリック       | 「住所は必須です」エラーが表示される |
| 4   | 地図で位置を選択せず「確認画面へ」をクリック | 位置選択エラーが表示される           |

#### 2.3 新規登録（3D映像付き）

| #   | 手順                             | 期待結果                           |
| --- | -------------------------------- | ---------------------------------- |
| 1   | 文化財情報を入力                 | -                                  |
| 2   | 「3D映像を追加」ボタンをクリック | 入力フォームが表示される           |
| 3   | URLを入力                        | 入力が反映される                   |
| 4   | タイトルを入力                   | 入力が反映される                   |
| 5   | 「追加」ボタンをクリック         | ムービーがリストに追加される       |
| 6   | 登録を完了                       | 文化財と3D映像が紐付いて登録される |

---

### 3. マイページ

#### 3.1 マイページ表示

| #   | 手順                                | 期待結果                               |
| --- | ----------------------------------- | -------------------------------------- |
| 1   | ログイン状態で `/mypage` にアクセス | マイページが表示される                 |
| 2   | プロフィールセクションを確認        | ユーザー名、登録件数が表示される       |
| 3   | 「マイ文化財」セクションを確認      | 登録した文化財がカード形式で表示される |
| 4   | 「マイ3D映像」セクションを確認      | 登録した3D映像がカード形式で表示される |

#### 3.2 文化財カード操作

| #   | 手順                                   | 期待結果                           |
| --- | -------------------------------------- | ---------------------------------- |
| 1   | 文化財カードの「編集」ボタンをクリック | 編集画面に遷移                     |
| 2   | 文化財カードの「削除」ボタンをクリック | 確認ダイアログが表示される         |
| 3   | 削除を確認                             | 文化財が削除され、リストから消える |

#### 3.3 3D映像カード操作

| #   | 手順                                   | 期待結果                         |
| --- | -------------------------------------- | -------------------------------- |
| 1   | 3D映像カードの「表示」ボタンをクリック | 3D映像表示画面が新しいタブで開く |
| 2   | 3D映像カードの「編集」ボタンをクリック | 編集画面に遷移                   |
| 3   | 3D映像カードの「削除」ボタンをクリック | 確認ダイアログが表示される       |

---

### 4. 文化財編集

#### 4.1 編集（正常系）

| #   | 手順                                     | 期待結果                               |
| --- | ---------------------------------------- | -------------------------------------- |
| 1   | 自分が登録した文化財の編集画面にアクセス | 既存データがフォームに表示される       |
| 2   | 名称を変更                               | 変更が反映される                       |
| 3   | 「保存する」ボタンをクリック             | 「保存しました」メッセージが表示される |
| 4   | マイページに自動遷移                     | 変更内容が反映されている               |

#### 4.2 編集（権限エラー）

| #   | 手順                                             | 期待結果                               |
| --- | ------------------------------------------------ | -------------------------------------- |
| 1   | 他のユーザーが登録した文化財の編集画面にアクセス | 「権限がありません」エラーが表示される |

#### 4.3 3D映像の追加・紐付け

| #   | 手順                                   | 期待結果                                     |
| --- | -------------------------------------- | -------------------------------------------- |
| 1   | 編集画面の「新規追加」ボタンをクリック | 入力フォームが表示される                     |
| 2   | URLを入力して「追加する」をクリック    | ムービーが作成され、紐付きリストに追加される |
| 3   | 「既存を紐付け」ボタンをクリック       | モーダルが表示される                         |
| 4   | 未紐付けの3D映像をクリック             | 紐付きリストに追加される                     |

#### 4.4 3D映像の紐付け解除・削除

| #   | 手順                                         | 期待結果                                       |
| --- | -------------------------------------------- | ---------------------------------------------- |
| 1   | 紐付き3D映像の「紐付け解除」ボタンをクリック | 確認ダイアログが表示される                     |
| 2   | 解除を確認                                   | リストから消え、「既存を紐付け」モーダルに移動 |
| 3   | 紐付き3D映像の「削除」ボタンをクリック       | 確認ダイアログが表示される                     |
| 4   | 削除を確認                                   | 3D映像が完全に削除される                       |

---

### 5. 3D映像編集

#### 5.1 編集（正常系）

| #   | 手順                                     | 期待結果                               |
| --- | ---------------------------------------- | -------------------------------------- |
| 1   | 自分が登録した3D映像の編集画面にアクセス | 既存データがフォームに表示される       |
| 2   | タイトルを変更                           | 変更が反映される                       |
| 3   | 「保存する」ボタンをクリック             | 「保存しました」メッセージが表示される |

---

### 6. レスポンシブ対応

#### 6.1 モバイル表示

| #   | 手順                                          | 期待結果                |
| --- | --------------------------------------------- | ----------------------- |
| 1   | スマートフォン幅（375px）で登録フォームを確認 | 1カラムレイアウトで表示 |
| 2   | 地図が画面幅に収まることを確認                | 横スクロールなしで表示  |
| 3   | ボタンがタップしやすいサイズであることを確認  | 44px以上のタップ領域    |

#### 6.2 タブレット表示

| #   | 手順                                    | 期待結果                  |
| --- | --------------------------------------- | ------------------------- |
| 1   | タブレット幅（768px）でマイページを確認 | 2カラムのカードレイアウト |

#### 6.3 デスクトップ表示

| #   | 手順                                           | 期待結果                  |
| --- | ---------------------------------------------- | ------------------------- |
| 1   | デスクトップ幅（1024px以上）でマイページを確認 | 3カラムのカードレイアウト |

---

### 7. エラーハンドリング

#### 7.1 ネットワークエラー

| #   | 手順                               | 期待結果                                 |
| --- | ---------------------------------- | ---------------------------------------- |
| 1   | オフライン状態で登録を試みる       | エラーメッセージが表示される             |
| 2   | バックエンドを停止して登録を試みる | 「保存に失敗しました」エラーが表示される |

#### 7.2 セッション切れ

| #   | 手順                                     | 期待結果                                 |
| --- | ---------------------------------------- | ---------------------------------------- |
| 1   | ログイン後、localStorageのトークンを削除 | 次の操作でサインインページにリダイレクト |

---

## チェックリスト

### 文化財登録

- [ ] 新規登録が正常に動作する
- [ ] 必須項目のバリデーションが動作する
- [ ] 3D映像付きで登録できる
- [ ] 確認画面で内容を確認できる
- [ ] 完了画面が表示される

### マイページ

- [ ] 登録した文化財が表示される
- [ ] 登録した3D映像が表示される
- [ ] 編集ボタンが動作する
- [ ] 削除ボタンが動作する

### 編集機能

- [ ] 文化財の編集ができる
- [ ] 3D映像の編集ができる
- [ ] 3D映像の追加ができる
- [ ] 既存3D映像の紐付けができる
- [ ] 紐付け解除ができる

### レスポンシブ

- [ ] モバイルで正常に表示される
- [ ] タブレットで正常に表示される
- [ ] デスクトップで正常に表示される

### エラーハンドリング

- [ ] バリデーションエラーが表示される
- [ ] ネットワークエラーが表示される
- [ ] 権限エラーが表示される
