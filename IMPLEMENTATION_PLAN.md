# 3DCP プロジェクト実装計画

## 1. 3Dモデルのサムネイル画像実装 (トップページ高速化)

### 現状の問題点
- トップページでは各文化財ごとに3Dモデル(LumaSplats)が直接読み込まれている
- すべての3Dモデルが同時に読み込まれるため、ページの初期ロードが遅く重くなっている

### 実装計画

#### フェーズ1: サムネイル生成システムの構築
1. **サムネイルモデルの追加**
   - `src/domains/models/thumbnail.ts` にサムネイルのデータモデルを定義
   - モデルインデックスへの追加

2. **サムネイル生成APIエンドポイントの作成**
   - `src/pages/api/thumbnails/generate.ts` に3Dモデルからサムネイル画像を生成するAPIを実装
   - 必要に応じてヘッドレスレンダリング機能の追加

3. **バックグラウンドでのサムネイル生成ジョブ**
   - 既存の3Dモデルデータに対してバッチ処理でサムネイルを生成
   - サムネイル画像の保存先としてpublicディレクトリを使用

#### フェーズ2: フロントエンドの改良

1. **ThreeCanvasコンポーネントの修正**
   - 初期表示ではサムネイル画像を表示
   - クリックやホバーなどのユーザーアクションがあったときのみ3Dモデルをロード
   - 遅延ロード用のLoaderコンポーネントを実装

2. **レイジーロード機能の実装**
   - スクロールして表示領域に入ったときのみ画像を読み込む機能強化
   - すでに使用されている`react-intersection-observer`を活用

## 2. ポッドキャスト機能の実装

### 実装計画

#### フェーズ1: 基本構造の構築

1. **データモデルの追加**
   - `src/domains/models/podcast.ts` にポッドキャストのデータモデルを定義
   - モデルインデックスへの追加

2. **音声アップロードコンポーネントの作成**
   - `src/components/blocks/AudioUploader.tsx` でファイルアップロード用UIを実装
   - プログレスバーとアップロード状態表示の追加

3. **音声ファイル保存用APIエンドポイント**
   - `src/pages/api/podcasts/upload.ts` に音声ファイルをアップロードして保存するAPIを実装
   - ファイル検証とセキュアなストレージ処理

#### フェーズ2: OpenAI Whisper APIとの連携

1. **Whisper API用のサービス作成**
   - `src/domains/services/whisper.ts` にOpenAI APIを利用した音声認識サービスを実装
   - APIキー管理と例外処理の追加

2. **音声認識処理用APIエンドポイント**
   - `src/pages/api/podcasts/transcribe.ts` でアップロードされた音声ファイルをWhisper APIで文字起こし
   - 結果の保存と関連付け

3. **一時的なAPIキー管理システム**
   - 環境変数で管理するか、一時的なキー生成システムを構築
   - セキュリティ考慮事項の文書化

#### フェーズ3: Difyとの連携 (オプション)

1. **Dify API連携サービス**
   - `src/domains/services/dify.ts` にDifyとのAPI連携用サービスを実装
   - 設定と認証フローの整備

2. **高度な音声処理パイプライン**
   - Whisperでの文字起こし後、Difyを通して要約・分析などの追加処理
   - 処理結果の保存と表示機能

#### フェーズ4: フロントエンド実装

1. **ポッドキャスト一覧ページ**
   - `src/pages/podcasts/index.tsx` にポッドキャスト一覧表示画面を実装
   - フィルタリングと検索機能の追加

2. **ポッドキャスト詳細ページ**
   - `src/pages/podcasts/[id].tsx` に個別ポッドキャスト再生・詳細表示画面を実装
   - 文字起こしテキストと関連情報の表示

3. **音声プレーヤーコンポーネント**
   - `src/components/blocks/AudioPlayer.tsx` にカスタム音声プレーヤーコンポーネントを実装
   - 再生制御とUI/UXの最適化

## 実装の優先順位と工程

1. まず3Dモデルのサムネイル表示システムを実装し、トップページの読み込み速度を改善
2. 次にポッドキャスト機能の基本構造を構築
3. OpenAI WhisperまたはDifyとの連携を実装
4. フロントエンドUIの洗練と最適化

## 必要なパッケージ

```bash
# サムネイル機能用
npm install sharp

# ポッドキャスト機能用
npm install openai @ffmpeg/ffmpeg @ffmpeg/util react-audio-player axios
```

## タイムライン目安

- フェーズ1（サムネイル基盤整備）: 1-2日
- フェーズ2（サムネイルフロントエンド）: 1-2日
- フェーズ3（ポッドキャスト基盤）: 2-3日
- フェーズ4（音声認識連携）: 1-2日
- フェーズ5（フロントエンド完成）: 2-3日

合計: 7-12日（実装の複雑さや要件の変更によって変動する可能性あり） 